# 智慧宿舍报修平台部署说明

本文档详细介绍了智慧宿舍报修平台前后端的部署步骤和配置要求。

## 目录

1. [后端部署](#后端部署)
2. [前端部署](#前端部署)
3. [环境配置](#环境配置)
4. [数据库配置](#数据库配置)
5. [生产环境安全建议](#生产环境安全建议)

## 后端部署

### 技术栈

- **.NET 8** - 最新的.NET框架
- **Entity Framework Core** - ORM框架
- **MySQL** - 数据库
- **JWT** - 身份认证
- **BCrypt** - 密码加密
- **RBAC** - 基于角色的权限控制

### 部署步骤

#### 1. 安装依赖

确保服务器已安装 .NET 8 SDK：
```bash
dotnet --version
```

如果未安装，请前往 [.NET官方网站](https://dotnet.microsoft.com/download/dotnet/8.0) 下载并安装。

#### 2. 获取源代码

将后端项目代码复制到服务器指定目录，例如：
```bash
cd /var/www
git clone <项目仓库地址>
# 或者直接复制项目文件夹
cp -r SmartDormitoryRepair.Api /var/www/
```

#### 3. 配置数据库连接

编辑 [appsettings.json](file:///F:/ItemsDemo/SmartDormitoryRepair/%E5%90%8E%E7%AB%AF/SmartDormitoryRepair.Api/appsettings.json) 文件，配置MySQL连接字符串：
```json
{
  "ConnectionStrings": {
    "Default": "Server=数据库服务器IP;Database=DormitoryRepair;User=用户名;Password=密码;Allow User Variables=true;"
  }
}
```

同时配置JWT密钥（建议修改为更安全的随机字符串）：
```json
{
  "Jwt": {
    "Key": "YourSuperSecretKeyThatIsAtLeast32CharactersLong!",
    "Issuer": "DormitoryRepair",
    "Audience": "DormitoryRepair",
    "ExpireMinutes": 60
  }
}
```

#### 4. 数据库初始化

系统会自动执行种子数据初始化，在首次启动时会创建必要的表结构并插入默认数据。

#### 5. 构建和运行项目

在项目根目录执行以下命令：
```bash
# 发布项目
dotnet publish -c Release -o ./publish

# 运行项目
cd ./publish
dotnet SmartDormitoryRepair.Api.dll
```

或者使用以下命令直接运行（适用于开发环境）：
```bash
dotnet run
```

后端API默认监听端口为 `5002`，可通过修改 [Program.cs](file:///F:/ItemsDemo/SmartDormitoryRepair/%E5%90%8E%E7%AB%AF/SmartDormitoryRepair.Api/Program.cs) 文件中的 `app.Run()` 参数更改。

### 后端服务管理

为了保证服务持续运行，建议使用 systemd (Linux) 或 NSSM (Windows) 将应用注册为系统服务。

#### Linux systemd 示例

创建服务文件 `/etc/systemd/system/dormitory-api.service`：
```ini
[Unit]
Description=Smart Dormitory Repair API
After=network.target

[Service]
WorkingDirectory=/var/www/SmartDormitoryRepair.Api
ExecStart=/usr/bin/dotnet /var/www/SmartDormitoryRepair.Api/publish/SmartDormitoryRepair.Api.dll
Restart=always
RestartSec=10
SyslogIdentifier=dormitory-api
User=www-data
Environment=ASPNETCORE_ENVIRONMENT=Production

[Install]
WantedBy=multi-user.target
```

启用并启动服务：
```bash
sudo systemctl enable dormitory-api.service
sudo systemctl start dormitory-api.service
```

## 前端部署

### 技术栈

- **Vue 3** - 使用Composition API
- **Element Plus** - 现代化UI组件库
- **Vue Router** - 单页应用路由管理
- **Axios** - HTTP客户端
- **Vite** - 新一代前端构建工具

### 部署步骤

#### 1. 安装Node.js环境

确保服务器已安装 Node.js (版本16+) 和 npm：
```bash
node --version
npm --version
```

如果未安装，请前往 [Node.js官网](https://nodejs.org/) 下载并安装。

#### 2. 获取源代码

将前端项目代码复制到服务器指定目录，例如：
```bash
cd /var/www
git clone <项目仓库地址>
# 或者直接复制项目文件夹
cp -r SmartDormitoryRepair.Web /var/www/
```

#### 3. 安装依赖

进入前端项目目录并安装依赖：
```bash
cd SmartDormitoryRepair.Web
npm install
```

#### 4. 配置API地址

编辑 `src/api/auth.js` 和 `src/api/orders.js` 文件，修改API基础地址为实际的后端服务地址：
```javascript
const api = axios.create({
  baseURL: 'http://你的后端服务器IP:5002/api'
});
```

#### 5. 构建生产版本

执行构建命令生成生产环境代码：
```bash
npm run build
```

构建完成后会在 `dist` 目录生成静态文件。

#### 6. 部署静态文件

将 `dist` 目录中的所有文件部署到Web服务器（如Nginx、Apache）的网站根目录。

#### Nginx配置示例

创建Nginx站点配置文件 `/etc/nginx/sites-available/dormitory-web`：
```nginx
server {
    listen 80;
    server_name 你的域名或服务器IP;

    location / {
        root /var/www/SmartDormitoryRepair.Web/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # 可选：配置HTTPS
    # listen 443 ssl;
    # ssl_certificate /path/to/ssl/cert.pem;
    # ssl_certificate_key /path/to/ssl/private.key;
}
```

启用站点并重启Nginx：
```bash
sudo ln -s /etc/nginx/sites-available/dormitory-web /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

## 环境配置

### 后端环境要求

1. **操作系统**：Windows/Linux/macOS
2. **运行时**：.NET 8 Runtime 或 .NET 8 SDK
3. **数据库**：MySQL 8.0+
4. **端口**：5002 (可配置)

### 前端环境要求

1. **Node.js**：16+ 版本
2. **npm**：8+ 版本
3. **Web服务器**：Nginx/Apache/IIS
4. **端口**：80 (HTTP) 或 443 (HTTPS)

## 数据库配置

### MySQL配置要求

1. **版本**：MySQL 8.0+
2. **字符集**：utf8mb4
3. **排序规则**：utf8mb4_unicode_ci

### 数据库连接配置

在 [appsettings.json](file:///F:/ItemsDemo/SmartDormitoryRepair/%E5%90%8E%E7%AB%AF/SmartDormitoryRepair.Api/appsettings.json) 中配置连接字符串：
```json
{
  "ConnectionStrings": {
    "Default": "Server=数据库服务器IP;Database=DormitoryRepair;User=用户名;Password=密码;Allow User Variables=true;"
  }
}
```

### 默认账户

系统初始化时会自动创建以下默认账户：

| 角色 | 用户名 | 密码 |
|------|--------|------|
| 管理员 | admin | admin123 |
| 学生 | student | student123 |
| 维修员 | repairman | repair123 |

> 注意：出于安全考虑，部署后请立即登录并修改默认账户密码。

## 生产环境安全建议

### 敏感信息保护
- 使用环境变量存储敏感配置信息
- 移除所有调试输出和日志中的敏感信息
- 使用强密码策略并定期更换密码

### 构建优化
- 在生产构建中移除所有调试代码
- 启用代码压缩和混淆
- 使用HTTPS协议传输数据

### 访问控制
- 严格限制文件和目录访问权限
- 实施适当的防火墙规则
- 定期更新系统和依赖包

更多安全建议请参考 [生产环境部署安全建议.md](file:///F:/ItemsDemo/SmartDormitoryRepair/%E6%96%87%E6%A1%A3/%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E5%AE%89%E5%85%A8%E5%BB%BA%E8%AE%AE.md) 文档。

## 故障排除

### 后端常见问题

1. **数据库连接失败**
   - 检查连接字符串是否正确
   - 确认MySQL服务是否正常运行
   - 检查防火墙是否允许相应端口通信

2. **JWT认证失败**
   - 检查Jwt配置项是否完整
   - 确认前后端时间是否同步

### 前端常见问题

1. **API请求失败**
   - 检查API基础地址配置是否正确
   - 确认后端服务是否正常运行
   - 检查跨域配置是否正确

2. **页面空白或加载异常**
   - 检查浏览器控制台错误信息
   - 确认构建过程是否有错误
   - 检查Nginx配置是否正确

## 许可证

本项目仅供学习交流使用。