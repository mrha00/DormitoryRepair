# 生产环境部署安全建议

本文档提供了将智慧宿舍报修平台部署到生产环境时的安全建议和最佳实践。

## 目录

1. [敏感信息保护](#敏感信息保护)
2. [日志安全管理](#日志安全管理)
3. [身份认证和授权](#身份认证和授权)
4. [网络安全](#网络安全)
5. [数据安全](#数据安全)
6. [前端安全](#前端安全)
7. [部署建议](#部署建议)

## 敏感信息保护

### 1. 配置文件安全
- 使用 `appsettings.Production.json` 替代 `appsettings.json` 存储生产环境配置
- 将敏感配置如数据库连接字符串、JWT密钥等存储在环境变量中
- 避免将敏感信息硬编码在代码中

### 2. 密码安全
- 修改所有默认账户密码，特别是管理员账户
- 强制用户在首次登录时修改默认密码
- 实施密码强度策略，要求使用复杂密码
- 定期轮换密码和密钥

### 3. 代码审查
- 移除所有调试输出语句（如 `Console.WriteLine`、`console.log`）
- 避免在错误消息中暴露系统内部信息
- 对外暴露的API应返回通用错误信息而非详细错误

## 日志安全管理

### 1. 日志级别控制
- 生产环境中将日志级别设置为 Warning 或更高
- 避免记录敏感信息如密码、令牌、个人身份信息等
- 对日志内容进行脱敏处理

### 2. 日志存储
- 定期轮换和清理日志文件
- 将日志存储在安全的位置，限制访问权限
- 考虑使用专业的日志管理系统如 ELK Stack

## 身份认证和授权

### 1. JWT安全
- 使用强密钥（至少32个字符）生成JWT令牌
- 设置合理的令牌过期时间
- 实施令牌刷新机制
- 使用HTTPS传输令牌

### 2. RBAC权限控制
- 确保所有API端点都有适当的权限检查
- 避免在客户端存储敏感权限信息
- 定期审查和更新权限配置

## 网络安全

### 1. HTTPS配置
- 强制使用HTTPS协议
- 使用有效的SSL证书
- 配置适当的HTTP安全头

### 2. CORS配置
- 严格限制允许的来源域名
- 避免使用通配符(*)允许所有来源

### 3. 防护措施
- 实施速率限制防止暴力破解
- 使用Web应用防火墙(WAF)
- 定期更新依赖包修复安全漏洞

## 数据安全

### 1. 数据库安全
- 使用参数化查询防止SQL注入
- 对敏感数据进行加密存储
- 定期备份数据库
- 限制数据库账户权限

### 2. 文件上传安全
- 验证上传文件类型和大小
- 将上传文件存储在安全位置
- 对上传文件进行病毒扫描

## 前端安全

### 1. 构建优化
- 在生产构建中移除所有调试代码
- 启用代码混淆和压缩
- 使用内容安全策略(CSP)头

### 2. 客户端存储
- 避免在localStorage中存储敏感信息
- 使用HttpOnly Cookie存储认证令牌
- 定期清理过期的存储数据

## 部署建议

### 1. 环境隔离
- 分离开发、测试和生产环境
- 使用不同的配置和数据库
- 限制生产环境访问权限

### 2. 监控和告警
- 实施应用性能监控(APM)
- 设置安全事件告警
- 定期进行安全审计

### 3. 备份和恢复
- 制定数据备份策略
- 定期测试恢复流程
- 保持备份数据的安全性

## 总结

通过实施以上安全建议，可以显著提高智慧宿舍报修平台在生产环境中的安全性。建议在每次部署前都进行安全检查，并定期更新安全措施以应对新的威胁。